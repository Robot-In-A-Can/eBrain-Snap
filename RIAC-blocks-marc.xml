<blocks app="Snap! 7dev, https://snap.berkeley.edu" version="2"><palette><category name="RIAC" color="216,45,45,1"/><category name="eBrain" color="33,33,33,1"/></palette><block-definition s="connect to IP %&apos;ip&apos;" type="command" category="other"><header></header><code></code><translations></translations><inputs><input type="%s"></input></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><block s="reportJoinWords"><list><l>if (eb == null ) {eb = new EveBrain(&apos;ws://</l><block var="ip"/><l>:8899/websocket&apos;);&#xD;console.log(eb.connected);&#xD;} else {&#xD;if (eb.connected == false) {&#xD;eb.url= "ws://</l><block var="ip"/><l>:8899/websocket";  eb.connect();}}</l></list></block></block><list></list></block></script></block-definition><block-definition s="connect USB" type="command" category="other"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>USBconnect();</l></block><list></list></block></script></block-definition><block-definition s="connected" type="reporter" category="other"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>&#xD;try {&#xD;  if ((eb != undefined ? eb.connected : false) || (world.USB != &apos;&apos; &amp;&amp; world.USB != undefined)){&#xD;    return true; &#xD;  } else {&#xD;    return false;&#xD;  }&#xD;} catch(e) {&#xD;  return false;&#xD;}</l></block><list></list></block></block></script></block-definition><block-definition s="test connection" type="command" category="other"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>try {&#xD;&#xD;  if ((eb != undefined ? eb.connected : false) || (world.USB != &apos;&apos; &amp;&amp; world.USB != undefined)){&#xD;    //it thinks its connected over websock, let&apos;s test the connection&#xD;   if (eb != undefined ? eb.connected : false) {&#xD;     eb.connected = false;&#xD;     eb.version(function(status,msg){eb.connected = true;});&#xD;   } else {&#xD;     //it thinks we are connected over USB&#xD;     world.USB = &apos;&apos;;&#xD;     writeToStream(&apos; {cmd: "version", id: "k1q6if75si"} &apos;);&#xD;   } &#xD;  }&#xD;} catch(e) {&#xD;  console.log(e);&#xD;}</l></block><list></list></block></script></block-definition><block-definition s="Connect to eBrain %&apos;ip&apos;" type="command" category="RIAC"><header></header><code></code><translations></translations><inputs><input type="%s">USB<options>USB&#xD;WIFI =192.168.4.1</options></input></inputs><script><block s="doIf"><block s="reportNot"><custom-block s="world modified"></custom-block></block><script><custom-block s="addJS %s"><custom-block s="eBrainJS"></custom-block></custom-block><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>world.modified = 1;</l></block><list></list></block></script></block><custom-block s="test connection"></custom-block><block s="doWait"><l>0.1</l></block><block s="doIf"><block s="reportNot"><custom-block s="connected"></custom-block></block><script><block s="doIf"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return location.protocol == &apos;http:&apos;</l></block><list></list></block><script><block s="doIfElse"><block var="ip"/><script><custom-block s="connect to IP %s"><block var="ip"/></custom-block></script><script><custom-block s="connect"></custom-block></script></block></script></block><block s="doIf"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return location.protocol == &apos;https:&apos;</l></block><list></list></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>world.port = &apos;&apos;;</l></block><list></list></block><custom-block s="connect USB"></custom-block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>eb == undefined;&#xD;return world.port;</l></block><list></list></block></block></script></block><block s="doIf"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return location.protocol == &apos;file:&apos;</l></block><list></list></block><script><block s="doIfElse"><block s="reportEquals"><block var="ip"/><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>world.port = &apos;&apos;;</l></block><list></list></block><custom-block s="connect USB"></custom-block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return world.port</l></block><list></list></block></block></script><script><block s="doIfElse"><block var="ip"/><script><custom-block s="connect to IP %s"><block var="ip"/></custom-block></script><script><custom-block s="connect"></custom-block></script></block></script></block></script></block><block s="doWait"><l>0.3</l></block><block s="doIf"><block s="reportNot"><custom-block s="connected"></custom-block></block><script><block s="doIf"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return location.protocol == &apos;http:&apos;</l></block><list></list></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>alert("Websocket Connection Failure! \n\nEnsure you are connected to the eBrain over the network, this version of Snap (http) cannot use the USB port.\n\n See Help for more details");</l></block><list></list></block></script></block><block s="doIf"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return location.protocol == &apos;https:&apos;</l></block><list></list></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>alert("USB Connection Failure!\n\nThis version of Snap (https) is secure and can only connect over USB, if you wish to connect using WebSockets please navigate to http.\n\nPlease connect your eBrain using a USB cable and make sure you have selected the correct port to commnicate with the eBrain");</l></block><list></list></block></script></block><block s="doIf"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return location.protocol == &apos;file:&apos;</l></block><list></list></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>alert("Connection Failure!\n\nIn this mode you may connect via USB or over WebSocket\n\nPlease type the IP address to use WebSockets or type USB to use the USB port")</l></block><list></list></block></script></block></script></block></script></block></script></block-definition><block-definition s="eBrainJS" type="reporter" category="other"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doReport"><l>var eb,escapable=/[\x00-\x1f\ud800-\udfff\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufff0-\uffff]/g,attempts=0;function filterUnicode(t){return escapable.lastIndex=0,escapable.test(t)?t.replace(escapable,function(t){return""}):t}var EveBrain=function(t){this.url=t,this.connect(),this.cbs={},this.listeners=[],this.sensorState={follow:null,collide:null},this.analogSensor={level:null},this.digitalSensor=[],this.wifiNetworks={},this.ipAddress={},this.distanceSensor={level:null},this.tempSensor={level:null},this.humidSensor={level:null}};let inputDone,outputDone;async function USBconnect(){world.port=await navigator.serial.requestPort(),await world.port.open({baudRate:230400});const t=new TextEncoderStream;outputDone=t.readable.pipeTo(world.port.writable),world.outputStream=t.writable,writeToStream(&apos; {cmd: "version", id: "k1q6if75si"} &apos;);let e=new TextDecoderStream;inputDone=world.port.readable.pipeTo(e.writable),inputStream=e.readable,world.reader=inputStream.getReader(),readLoop()}async function readLoop(){for(world.USB="",console.log("USB Reader Listening...");;){const{value:t,done:e}=await world.reader.read();if(t&amp;&amp;(t.includes("{")&amp;&amp;(world.USB=""),world.USB+=t,console.log(t+"\n")),e){console.log("[readLoop] DONE",e),world.reader.releaseLock();break}}}function writeToStream(...t){const e=world.outputStream.getWriter();t.forEach(t=&gt;{console.log("[SEND]",t),e.write(t+"\n")}),e.releaseLock()}EveBrain.prototype={connected:!1,error:!1,timeoutTimer:void 0,connect:function(){if(!this.connected&amp;&amp;!this.error){var t=this;try{clearTimeout(t.timeoutTimer),clearTimeout(t.connTimeout),clearTimeout(t.reconnectTimer),t.ws.close(),t.robot_state="idle",t.msg_stack=[],t.cbs={}}catch(t){console.log(t)}this.has_connected=!1,this.ws=filterUnicode(new WebSocket(this.url)),this.ws.onmessage=function(e){t.handle_ws(e)},this.ws.onopen=function(){t.version(function(){t.setConnectedState(!0),attempts=0})},this.ws.onerror=function(e){t.handleError(e),attempts+=1},this.ws.onclose=function(e){t.handleError(e),attempts+=1},attempts&lt;10&amp;&amp;(this.connTimeout=window.setTimeout(function(){if(!t.connected)try{t.ws.close()}catch(t){console.log(t)}},1e3))}},refresh:function(){var t=this;t.ws.close(),clearTimeout(t.connTimeout),t.robot_state="idle",t.msg_stack=[],t.cbs={},this.has_connected=!1,this.ws=filterUnicode(new WebSocket(this.url)),this.ws.onmessage=function(e){t.handle_ws(e)},this.ws.onopen=function(){t.version(function(){t.setConnectedState(!0)})},this.ws.onerror=function(e){t.handleError(e)},this.ws.onclose=function(e){t.handleError(e)}},setConnectedState:function(t){var e=this;clearTimeout(e.connTimeout),e.connected=t,t&amp;&amp;(e.has_connected=!0),e.has_connected&amp;&amp;setTimeout(function(){e.broadcast(e.connected?"connected":"disconnected")},100),t?e.reconnectTimer&amp;&amp;(clearTimeout(e.reconnectTimer),e.reconnectTimer=void 0):!e.reconnectTimer&amp;&amp;attempts&lt;10&amp;&amp;(e.reconnectTimer=setTimeout(function(){e.reconnectTimer=void 0,e.connect()},1e3))},broadcast:function(t){for(i in this.listeners)this.listeners.hasOwnProperty(i)&amp;&amp;this.listeners[i](t)},addListener:function(t){this.listeners.push(t)},handleError:function(t){t instanceof CloseEvent||"Timeout"===t?(this.ws.readyState===WebSocket.OPEN&amp;&amp;this.ws.close(),this.setConnectedState(!1),clearTimeout(self.reconnectTimer),self.reconnectTimer=void 0,this.msg_stack=[]):console.log(t)},move:function(t,e,s){this.send({cmd:t,arg:e},s)},turn:function(t,e,s){this.send({cmd:t,arg:e},s)},forward:function(t,e){this.move("forward",t,e)},back:function(t,e){this.move("back",t,e)},left:function(t,e){this.move("right",t,e)},right:function(t,e){this.move("left",t,e)},leftMotorForward:function(t,e){this.move("leftMotorF",t,e)},rightMotorForward:function(t,e){this.move("rightMotorF",t,e)},leftMotorBackward:function(t,e){this.move("leftMotorB",t,e)},rightMotorBackward:function(t,e){this.move("rightMotorB",t,e)},arc:function(t,e,s,n){this.send({cmd:"arc",arg:[t,e,s]},n)},gpio:function(t,e,s){this.send({cmd:e[0],arg:t},s)},analogInput:function(t,e){var s=this;this.send({cmd:"analogInput",arg:t},function(t,n){"complete"===t&amp;&amp;null!=n&amp;&amp;(s.analogSensor.level=n.msg,e(s.analogSensor.level))})},analogInputPCF:function(t,e){var s=this;this.send({cmd:"readSensors",arg:t},function(t,n){"complete"===t&amp;&amp;null!=n&amp;&amp;(s.analogSensor.level=n.msg,e(s.analogSensor.level))})},temperature:function(t){var e=this;this.send({cmd:"temperature"},function(s,n){"complete"===s&amp;&amp;null!=n&amp;&amp;(e.tempSensor.level=n.msg,t(e.tempSensor.level))})},humidity:function(t){var e=this;this.send({cmd:"humidity"},function(s,n){"complete"===s&amp;&amp;null!=n&amp;&amp;(e.humidSensor.level=n.msg,t(e.humidSensor.level))})},digitalInput:function(t,e){var s=this;this.send({cmd:"digitalInput",arg:t},function(n,o){"complete"===n&amp;&amp;null!=o&amp;&amp;(s.digitalSensor[t]=o.msg,e(s.digitalSensor[t]))})},distanceInput:function(t){var e=this;this.send({cmd:"distanceSensor"},function(s,n){"complete"===s&amp;&amp;null!=n&amp;&amp;(e.distanceSensor.level=n.msg,t(e.distanceSensor.level))})},gpio_pwm:function(t,e,s){this.send({cmd:t,arg:e},s)},servo:function(t,e){this.send({cmd:"servo",arg:t},e)},beep:function(t,e,s){this.send({cmd:"beep",arg:[t,1e3*e]},s)},stop:function(t){var e=this;this.send({cmd:"stop"},function(s,n,o){if("complete"===s&amp;&amp;!o){for(var i in e.cbs)e.cbs[i]("complete",void 0,!0);e.robot_state="idle",e.msg_stack=[],e.cbs={},t&amp;&amp;t(s)}})},pause:function(t){this.send({cmd:"pause"},t)},resume:function(t){this.send({cmd:"resume"},t)},ping:function(t){this.send({cmd:"ping"},t)},version:function(t){this.send({cmd:"version"},t)},getNetworks:function(t){this.send({cmd:"startWifiScan"},function(e,s){"notify"===e&amp;&amp;null!=s&amp;&amp;t(s.msg)})},getIp:function(t){this.send({cmd:"getConfig"},function(e,s){"complete"===e&amp;&amp;null!=s&amp;&amp;t(s.msg)})},send:function(t,e){(t=filterUnicode(t)).id=Math.random().toString(36).substr(2,10),e&amp;&amp;(this.cbs[t.id]=e),t.arg&amp;&amp;(t.arg=t.arg.toString()),["stop","pause","resume","ping","version"].indexOf(t.cmd)&gt;=0?this.send_msg(t):(this.msg_stack.push(t),this.process_msg_queue())},send_msg:function(t){var e=this;t=filterUnicode(t),console.log(t),this.ws.readyState===WebSocket.OPEN&amp;&amp;this.ws.send(JSON.stringify(t)),this.timeoutTimer=window.setTimeout(function(){e.handleError("Timeout")},3e3)},process_msg_queue:function(){"idle"===this.robot_state&amp;&amp;this.msg_stack.length&gt;0&amp;&amp;(this.robot_state="receiving",this.send_msg(this.msg_stack[0]))},handle_ws:function(t){if(void 0!==t){if(msg=JSON.parse(t.data),msg.msg=filterUnicode(msg.msg),msg.id=filterUnicode(msg.id),msg.status=filterUnicode(msg.status),console.log(msg),clearTimeout(this.timeoutTimer),"notify"===msg.status)return this.broadcast(msg.id),void(this.sensorState[msg.id]=msg.msg);this.msg_stack.length&gt;0&amp;&amp;this.msg_stack[0].id==msg.id?"accepted"===msg.status?(this.cbs[msg.id]&amp;&amp;this.cbs[msg.id]("started",msg),this.robot_state="running"):"complete"===msg.status&amp;&amp;(this.cbs[msg.id]&amp;&amp;(this.cbs[msg.id]("complete",msg),delete this.cbs[msg.id]),this.msg_stack.shift(),0===this.msg_stack.length&amp;&amp;this.broadcast("program_complete"),this.robot_state="idle",this.process_msg_queue()):this.cbs[msg.id]&amp;&amp;(this.cbs[msg.id]("complete",msg),delete this.cbs[msg.id]),msg.status&amp;&amp;"error"===msg.status&amp;&amp;"Too many connections"===msg.msg&amp;&amp;(this.error=!0,this.broadcast("error"))}else t.data=0,t.status=0,t.id=0},robot_state:"idle",msg_stack:[]},world.digitalSensor=[];</l></block></script></block-definition><block-definition s="addJS %&apos;JS_FILE&apos;" type="command" category="other"><header></header><code></code><translations></translations><inputs><input type="%s"></input></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l>JS_FILE</l></list><l>var po = document.createElement(&apos;script&apos;);&#xD;  po.type = &apos;text/javascript&apos;;&#xD;  po.async = true;&#xD;  po.innerHTML = JS_FILE;&#xD;  var s = document.getElementsByTagName(&apos;script&apos;)[0];&#xD;  s.parentNode.insertBefore(po, s)</l></block><list><block var="JS_FILE"/></list></block></script></block-definition><block-definition s="world modified" type="reporter" category="other"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return world.modified == 1 || world.modified != undefined;</l></block><list></list></block></block></script></block-definition><block-definition s="Forward %&apos;mm&apos;" type="command" category="RIAC"><header></header><code></code><translations></translations><inputs><input type="%s">100</input></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>mm</l></list><l>world.moveon = 0;&#xD;eb.forward(mm,function(state,msg){&#xD;        if(state == &apos;complete&apos;){&#xD;          world.moveon = 1;&#xD;        }&#xD;  });</l></block><list><block var="mm"/></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return world.moveon;</l></block><list></list></block></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>mm</l></list><l>try { &#xD;world.id = Math.random().toString(36).substr(2, 10);&#xD;writeToStream(&apos;{cmd: "forward", arg: &apos;+mm+&apos;, id: "&apos;+world.id+&apos;"}&apos;);&#xD;}&#xD;catch(e) {&#xD;}</l></block><list><block var="mm"/></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l>Pin</l></list><l>try {&#xD;var msg = 0;&#xD;msg.id = 0;&#xD;msg = JSON.parse(world.USB);&#xD;return (msg.id == world.id);&#xD;}catch(e){&#xD;return 0;&#xD;}</l></block><list></list></block></block></script></block></script></block-definition><block-definition s="Back %&apos;mm&apos;" type="command" category="RIAC"><header></header><code></code><translations></translations><inputs><input type="%s">100</input></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>mm</l></list><l>world.moveon = 0;&#xD;eb.back(mm,function(state,msg){&#xD;        if(state == &apos;complete&apos;){&#xD;          world.moveon = 1;&#xD;        }&#xD;  });</l></block><list><block var="mm"/></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return world.moveon;</l></block><list></list></block></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>mm</l></list><l>try { &#xD;world.id = Math.random().toString(36).substr(2, 10);&#xD;writeToStream(&apos;{cmd: "back", arg: &apos;+mm+&apos;, id: "&apos;+world.id+&apos;"}&apos;);&#xD;}&#xD;catch(e) {&#xD;}</l></block><list><block var="mm"/></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l>Pin</l></list><l>try {&#xD;var msg = 0;&#xD;msg.id = 0;&#xD;msg = JSON.parse(world.USB);&#xD;return (msg.id == world.id);&#xD;}catch(e){&#xD;return 0;&#xD;}</l></block><list></list></block></block></script></block></script></block-definition><block-definition s="Left %&apos;mm&apos;" type="command" category="RIAC"><header></header><code></code><translations></translations><inputs><input type="%s">90</input></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>mm</l></list><l>world.moveon = 0;&#xD;eb.left(mm,function(state,msg){&#xD;        if(state == &apos;complete&apos;){&#xD;          world.moveon = 1;&#xD;        }&#xD;  });</l></block><list><block var="mm"/></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return world.moveon;</l></block><list></list></block></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>mm</l></list><l>try { &#xD;world.id = Math.random().toString(36).substr(2, 10);&#xD;writeToStream(&apos;{cmd: "left", arg: &apos;+mm+&apos;, id: "&apos;+world.id+&apos;"}&apos;);&#xD;}&#xD;catch(e) {&#xD;}</l></block><list><block var="mm"/></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l>Pin</l></list><l>try {&#xD;var msg = 0;&#xD;msg.id = 0;&#xD;msg = JSON.parse(world.USB);&#xD;return (msg.id == world.id);&#xD;}catch(e){&#xD;return 0;&#xD;}</l></block><list></list></block></block></script></block></script></block-definition><block-definition s="Right %&apos;mm&apos;" type="command" category="RIAC"><header></header><code></code><translations></translations><inputs><input type="%s">90</input></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>mm</l></list><l>world.moveon = 0;&#xD;eb.right(mm,function(state,msg){&#xD;        if(state == &apos;complete&apos;){&#xD;          world.moveon = 1;&#xD;        }&#xD;  });</l></block><list><block var="mm"/></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return world.moveon;</l></block><list></list></block></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>mm</l></list><l>try { &#xD;world.id = Math.random().toString(36).substr(2, 10);&#xD;writeToStream(&apos;{cmd: "right", arg: &apos;+mm+&apos;, id: "&apos;+world.id+&apos;"}&apos;);&#xD;}&#xD;catch(e) {&#xD;}</l></block><list><block var="mm"/></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l>Pin</l></list><l>try {&#xD;var msg = 0;&#xD;msg.id = 0;&#xD;msg = JSON.parse(world.USB);&#xD;return (msg.id == world.id);&#xD;}catch(e){&#xD;return 0;&#xD;}</l></block><list></list></block></block></script></block></script></block-definition><block-definition s="connect" type="command" category="other"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>if (eb == null) {&#xD;eb = new EveBrain(&apos;ws://192.168.4.1:8899/websocket&apos;);&#xD;&#xD;console.log(eb.connected);&#xD;} else {&#xD;if (eb.connected == false) {&#xD;eb.url = "ws://192.168.4.1:8899/websocket";&#xD;eb.connect();&#xD;}&#xD;}</l></block><list></list></block></script></block-definition><block-definition s="connection type" type="reporter" category="other"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>try {&#xD;  if(eb != undefined ? eb.connected : false){&#xD;    return &apos;WEB&apos;; &#xD;  }  &#xD; else if(world.USB != &apos;&apos; &amp;&amp; world.USB != undefined){&#xD;    return &apos;USB&apos;; &#xD;  }&#xD; else {&#xD;   return &apos;NONE&apos;; &#xD;  }&#xD;} catch(e) {&#xD;  return "NONE";&#xD;}</l></block><list></list></block></block></script></block-definition><block-definition s="Stop" type="command" category="RIAC"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list></list><l>eb.stop();</l></block><list></list></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list></list><l>try{&#xD;writeToStream(&apos; {cmd: "stop", id: "k1q6if75si"} &apos;);&#xD;}&#xD;catch(e) {&#xD;} </l></block><list></list></block></script></block></script></block-definition><block-definition s="Pause" type="command" category="other"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list></list><l>eb.pause();</l></block><list></list></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list></list><l>try{&#xD;writeToStream(&apos; {cmd: "pause", id: "k1q6if75si"} &apos;);&#xD;}&#xD;catch(e){&#xD;}&#xD;</l></block><list></list></block></script></block></script></block-definition><block-definition s="Resume" type="command" category="other"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list></list><l>eb.resume();</l></block><list></list></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list></list><l>try{&#xD;writeToStream(&apos; {cmd: "resume", id: "k1q6if75si"} &apos;);&#xD;}&#xD;catch(e){&#xD;}</l></block><list></list></block></script></block></script></block-definition><block-definition s="GPIO Write Pin: %&apos;Pin&apos; %&apos;ON/OFF&apos;" type="command" category="eBrain"><header></header><code></code><translations></translations><inputs><input type="%s" readonly="true">4<options>4&#xD;5&#xD;10&#xD;16&#xD;14&#xD;12&#xD;13&#xD;0&#xD;2</options></input><input type="%s" readonly="true">gpio_on<options>gpio_on&#xD;gpio_off</options></input></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>Pin</l><l>State</l></list><l>try{&#xD;eb.gpio(Pin,[State],function(){});&#xD;}&#xD;catch(e){&#xD;}</l></block><list><block var="Pin"/><block var="ON/OFF"/></list></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>Pin</l><l>State</l></list><l>try{&#xD;writeToStream(&apos; {arg: &apos;+Pin+&apos;, cmd: "&apos;+State+&apos;", id: "k1q6if75si"} &apos;);&#xD;}&#xD;catch(e){&#xD;}</l></block><list><block var="Pin"/><block var="ON/OFF"/></list></block></script></block></script></block-definition><block-definition s="GPIO Read Pin %&apos;Pin&apos;" type="reporter" category="eBrain"><header></header><code></code><translations></translations><inputs><input type="%s" readonly="true">4<options>4&#xD;5&#xD;10&#xD;16&#xD;14&#xD;12&#xD;13&#xD;0&#xD;2</options></input></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>Pin</l></list><l>world.moveon = 0;&#xD;eb.digitalInput(Pin,function(){world.moveon = 1;});</l></block><list><block var="Pin"/></list></block><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l>Pin</l></list><l>return eb.digitalSensor[Pin];</l></block><list><block var="Pin"/></list></block></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>Pin</l></list><l>try { &#xD;world.id = Math.random().toString(36).substr(2, 10);&#xD;writeToStream(&apos;{cmd: "digitalInput", arg: &apos;+Pin+&apos;, id: "&apos;+world.id+&apos;"}&apos;);&#xD;}&#xD;catch(e) {&#xD;}</l></block><list><block var="Pin"/></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l>Pin</l></list><l>try {&#xD;var msg = 0;&#xD;msg.id = 0;&#xD;msg = JSON.parse(world.USB);&#xD;world.digitalSensor[Pin] = msg.msg;&#xD;return (msg.id == world.id);&#xD;}catch(e){&#xD;return 0;&#xD;}</l></block><list><block var="Pin"/></list></block></block><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l>Pin</l></list><l>try {&#xD;return world.digitalSensor[Pin];&#xD;}catch(e){&#xD;return 0;&#xD;}</l></block><list><block var="Pin"/></list></block></block></script></block></script></block-definition><block-definition s="Analog Read" type="reporter" category="eBrain"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list></list><l>function next(e) {;&#xD;return eb.analogSensor;&#xD;}&#xD;eb.analogInput(0,next);&#xD;return eb.analogSensor.level;</l></block><list></list></block></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list></list><l>try{&#xD;  writeToStream(&apos;{cmd: "analogInput", arg: "A0", id: "k1q6if75si"}&apos;);&#xD;  var J = JSON.parse(world.USB);&#xD;  if (Number.isInteger(J.msg)) {&#xD;    return J.msg;&#xD;  }&#xD;  return 0;&#xD;}&#xD;catch(e){&#xD;  return 0; &#xD;}</l></block><list></list></block></block></script></block></script></block-definition><block-definition s="Read Distance" type="reporter" category="eBrain"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>world.moveon = 0;&#xD;eb.distanceInput(function(){world.moveon = 1;})</l></block><list></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return world.moveon;</l></block><list></list></block></block><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l>Pin</l></list><l>return  eb.distanceSensor.level;</l></block><list></list></block></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>try { &#xD;world.id = Math.random().toString(36).substr(2, 10);&#xD;writeToStream(&apos;{cmd: "distanceSensor", id: "&apos;+world.id+&apos;"}&apos;); &#xD;}&#xD;catch(e) {&#xD;}</l></block><list></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>try {&#xD;var msg = 0;&#xD;msg.id = 0;&#xD;msg = JSON.parse(world.USB);&#xD;world.distanceSensor = msg.msg;&#xD;return (msg.id == world.id &amp;&amp; msg.status == "complete");&#xD;}catch(e){&#xD;return 0;&#xD;}</l></block><list></list></block></block><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>try {&#xD;return world.distanceSensor;&#xD;}catch(e){&#xD;return 0;&#xD;}</l></block><list></list></block></block></script></block></script></block-definition><block-definition s="Temperature Read" type="reporter" category="eBrain"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>world.moveon = 0;&#xD;eb.temperature(function(){world.moveon = 1;})</l></block><list></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return world.moveon;</l></block><list></list></block></block><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return eb.tempSensor.level;</l></block><list></list></block></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>try { &#xD;world.id = Math.random().toString(36).substr(2, 10);&#xD;writeToStream(&apos;{cmd: "temperature", id: "&apos;+world.id+&apos;"}&apos;); &#xD;}&#xD;catch(e) {&#xD;}</l></block><list></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>try { &#xD;var msg = 0;&#xD;msg.id = 0;&#xD;msg = JSON.parse(world.USB);&#xD;world.temperature = msg.msg;&#xD;return (msg.id == world.id &amp;&amp; msg.status == "complete");&#xD;}&#xD;catch(e) {&#xD;return 0;&#xD;}</l></block><list></list></block></block><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>try {&#xD;return world.temperature;&#xD;}catch(e){&#xD;return 0;&#xD;}</l></block><list></list></block></block></script></block></script></block-definition><block-definition s="Humidity Read" type="reporter" category="eBrain"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>world.moveon = 0;&#xD;eb.humidity(function(){world.moveon = 1;})</l></block><list></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return world.moveon;</l></block><list></list></block></block><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return eb.humidSensor.level;</l></block><list></list></block></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>try { &#xD;world.id = Math.random().toString(36).substr(2, 10);&#xD;writeToStream(&apos;{cmd: "humidity", id: "&apos;+world.id+&apos;"}&apos;); &#xD;}&#xD;catch(e) {&#xD;}</l></block><list></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>try { &#xD;var msg = 0;&#xD;msg.id = 0;&#xD;msg = JSON.parse(world.USB);&#xD;world.humidity = msg.msg;&#xD;return (msg.id == world.id &amp;&amp; msg.status == "complete");&#xD;}&#xD;catch(e) {&#xD;return 0;&#xD;}</l></block><list></list></block></block><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>try {&#xD;return world.humidity;&#xD;}catch(e){&#xD;return 0;&#xD;}</l></block><list></list></block></block></script></block></script></block-definition><block-definition s="PWM Pin: %&apos;Pin&apos; Value (0-255): %&apos;pin_value&apos;" type="command" category="eBrain"><header></header><code></code><translations></translations><inputs><input type="%s" readonly="true">5<options>5&#xD;10&#xD;16</options></input><input type="%n">255</input></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doIf"><block s="reportEquals"><block var="Pin"/><l>5</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>pin_value</l></list><l>eb.gpio_pwm("gpio_pwm_5",pin_value);</l></block><list><block var="pin_value"/></list></block></script></block><block s="doIf"><block s="reportEquals"><block var="Pin"/><l>10</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>pin_value</l></list><l>eb.gpio_pwm("gpio_pwm_10",pin_value);</l></block><list><block var="pin_value"/></list></block></script></block><block s="doIf"><block s="reportEquals"><block var="Pin"/><l>16</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>pin_value</l></list><l>eb.gpio_pwm("gpio_pwm_16",pin_value);</l></block><list><block var="pin_value"/></list></block></script></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doIf"><block s="reportEquals"><block var="Pin"/><l>5</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>pin_value</l></list><l>try{&#xD;writeToStream(&apos;{cmd: "gpio_pwm_5", arg: &apos;+pin_value+&apos;, id: "k1q6if75si"}&apos;);&#xD;var J = JSON.parse(world.USB);&#xD;return J.msg;&#xD;}&#xD;catch(e){&#xD;return 0; &#xD;}</l></block><list><block var="pin_value"/></list></block></script></block><block s="doIf"><block s="reportEquals"><block var="Pin"/><l>10</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>pin_value</l></list><l>try{&#xD;writeToStream(&apos;{cmd: "gpio_pwm_10", arg: &apos;+pin_value+&apos;, id: "k1q6if75si"}&apos;);&#xD;var J = JSON.parse(world.USB);&#xD;return J.msg;&#xD;}&#xD;catch(e){&#xD;return 0; &#xD;}</l></block><list><block var="pin_value"/></list></block></script></block><block s="doIf"><block s="reportEquals"><block var="Pin"/><l>16</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>pin_value</l></list><l>try{&#xD;writeToStream(&apos;{cmd: "gpio_pwm_16", arg: &apos;+pin_value+&apos;, id: "k1q6if75si"}&apos;);&#xD;var J = JSON.parse(world.USB);&#xD;return J.msg;&#xD;}&#xD;catch(e){&#xD;return 0; &#xD;}</l></block><list><block var="pin_value"/></list></block></script></block></script></block></script></block-definition><block-definition s="Beep Pin 5 Duration: %&apos;duration&apos; Note: %&apos;note&apos;" type="command" category="eBrain"><header></header><code></code><translations></translations><inputs><input type="%n">1</input><input type="%n">60</input></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>duration</l><l>note</l></list><l>world.moveon = 0;&#xD;eb.beep(note,duration,function(){world.moveon = 1;});</l></block><list><block var="duration"/><block var="note"/></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return world.moveon;</l></block><list></list></block></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>duration</l><l>note</l></list><l>try{&#xD;writeToStream(&apos;{cmd: "beep", arg: "&apos;+note+&apos;,&apos;+(duration*1000)+&apos;", id: "k1q6if75si"}&apos;);&#xD;var J = JSON.parse(world.USB);&#xD;return J.msg;&#xD;}&#xD;catch(e){&#xD;return 0; &#xD;}</l></block><list><block var="duration"/><block var="note"/></list></block><block s="doWait"><block var="duration"/></block></script></block></script></block-definition><block-definition s="Connect to Network SSID: %&apos;SSID&apos; Password: %&apos;PASS&apos;" type="command" category="eBrain"><header></header><code></code><translations></translations><inputs><input type="%s"></input><input type="%s"></input></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>SSID</l><l>PASS</l></list><l>var msg = {cmd:"setConfig", arg:{"sta_ssid":SSID,"sta_pass":PASS}, "id":Math.random().toString(36).substr(2, 10)};&#xD;msg = filterUnicode(msg);&#xD;eb.send_msg(msg);</l></block><list><block var="SSID"/><block var="PASS"/></list></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>SSID</l><l>PASS</l></list><l>try{&#xD;writeToStream(&apos;{cmd: "setConfig", arg:{\&apos;sta_ssid\&apos;:\&apos;&apos;+SSID+&apos;\&apos;,\&apos;sta_pass\&apos;:\&apos;&apos;+PASS+&apos;\&apos;}, id: "3d8d9d4f6k"}&apos;);&#xD;}&#xD;catch(e){&#xD;console.log(0)&#xD;}</l></block><list><block var="SSID"/><block var="PASS"/></list></block></script></block></script></block-definition><block-definition s="Get WiFi Networks" type="reporter" category="other"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>eb.send({cmd: &apos;startWifiScan&apos;}, function(state, msg){&#xD;      if(state === &apos;notify&apos; &amp;&amp; undefined != msg){&#xD;        cb(msg.msg);&#xD;      }&#xD;    });&#xD;var networks = eb.sensorState["wifiScan"];&#xD;let txt = "";&#xD;for (let i = 0; i &lt; networks.length; i++){&#xD;&#xD;txt = txt.concat(networks[i][0]);&#xD;if(i != networks.length){  &#xD;  txt = txt.concat(",");}&#xD;}&#xD;return(networks);</l></block><list></list></block></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list></list><l>try{&#xD;writeToStream(&apos;{cmd: "startWifiScan", id: "k1q6if75si"}&apos;);&#xD;var J = JSON.parse(world.USB);&#xD;return J.msg;&#xD;}&#xD;catch(e){&#xD;return 0; &#xD;}</l></block><list></list></block></block></script></block></script></block-definition><block-definition s="Set Servo %&apos;one&apos; Angle %&apos;angle&apos;" type="command" category="eBrain"><header></header><code></code><translations></translations><inputs><input type="%s" readonly="true">1<options>1&#xD;2</options></input><input type="%n">90</input></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doIfElse"><block s="reportEquals"><block var="one"/><l>1</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>angle</l></list><l>world.moveon = 0;&#xD;eb.send({cmd: "servo",arg:angle},function(){world.moveon = 1;});</l></block><list><block var="angle"/></list></block></script><script><block s="doRun"><block s="reportJSFunction"><list><l>angle</l></list><l>world.moveon = 0;&#xD;eb.send({cmd: "servoII",arg:angle},function(){world.moveon = 1;});</l></block><list><block var="angle"/></list></block></script></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return world.moveon;</l></block><list></list></block></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doIfElse"><block s="reportEquals"><block var="one"/><l>1</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>angle</l></list><l>try{&#xD;writeToStream(&apos;{cmd: "servo", arg:"&apos;+angle+&apos;", id: "3d8d9d4f6k"}&apos;);&#xD;}&#xD;catch(e){&#xD;console.log(e);&#xD;}</l></block><list><block var="angle"/></list></block></script><script><block s="doRun"><block s="reportJSFunction"><list><l>angle</l></list><l>try{&#xD;writeToStream(&apos;{cmd: "servoII", arg:"&apos;+angle+&apos;", id: "3d8d9d4f6k"}&apos;);&#xD;}&#xD;catch(e){&#xD;console.log(e);&#xD;}</l></block><list><block var="angle"/></list></block></script></block></script></block></script></block-definition><block-definition s="Get IP" type="reporter" category="other"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>world.moveon = 0;&#xD;eb.getIp(function(){world.moveon = 1;});</l></block><list></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list></list><l>return world.moveon;</l></block><list></list></block></block><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return  msg.msg.sta_ip;</l></block><list></list></block></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>try { &#xD;world.id = Math.random().toString(36).substr(2, 10);&#xD;writeToStream(&apos;{cmd: "getConfig", id: "&apos;+world.id+&apos;"}&apos;); &#xD;}&#xD;catch(e) {&#xD;}</l></block><list></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>try {&#xD;var msg = 0;&#xD;msg.id = 0;&#xD;msg = JSON.parse(world.USB);&#xD;world.ip = msg.msg;&#xD;return (msg.id == world.id);&#xD;}catch(e){&#xD;return 0;&#xD;}</l></block><list></list></block></block><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>try {&#xD;return world.ip.sta_ip;&#xD;}catch(e){&#xD;return 0;&#xD;}</l></block><list></list></block></block></script></block></script></block-definition><block-definition s="Get Config" type="reporter" category="other"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>world.moveon = 0;&#xD;eb.getIp(function(){world.moveon = 1;});</l></block><list></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list></list><l>return world.moveon;</l></block><list></list></block></block><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return  JSON.stringify(msg.msg);</l></block><list></list></block></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>try { &#xD;world.id = Math.random().toString(36).substr(2, 10);&#xD;writeToStream(&apos;{cmd: "getConfig", id: "&apos;+world.id+&apos;"}&apos;); &#xD;}&#xD;catch(e) {&#xD;}</l></block><list></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l>Pin</l></list><l>try { &#xD;var msg = 0;&#xD;msg.id = 0;&#xD;msg = JSON.parse(world.USB);&#xD;world.ip = msg.msg;&#xD;return (msg.id == world.id);&#xD;}&#xD;catch(e) {&#xD;}</l></block><list></list></block></block><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l>Pin</l></list><l>try {&#xD;return JSON.stringify(world.ip);&#xD;}catch(e){&#xD;return 0;&#xD;}</l></block><list></list></block></block></script></block></script></block-definition><block-definition s="Get Robot Name" type="reporter" category="other"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>world.moveon = 0;&#xD;eb.getIp(function(){world.moveon = 1;});</l></block><list></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list></list><l>return world.moveon;</l></block><list></list></block></block><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>return  msg.msg.ap_ssid;</l></block><list></list></block></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>try { &#xD;world.id = Math.random().toString(36).substr(2, 10);&#xD;writeToStream(&apos;{cmd: "getConfig", id: "&apos;+world.id+&apos;"}&apos;); &#xD;}&#xD;catch(e) {&#xD;}</l></block><list></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>try {&#xD;var msg = 0;&#xD;msg.id = 0;&#xD;msg = JSON.parse(world.USB);&#xD;world.ip = msg.msg;&#xD;return (msg.id == world.id);&#xD;}catch(e){&#xD;return 0;&#xD;}</l></block><list></list></block></block><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l></l></list><l>try {&#xD;return world.ip.ap_ssid;&#xD;}catch(e){&#xD;return 0;&#xD;}</l></block><list></list></block></block></script></block></script></block-definition><block-definition s="%&apos;motor&apos; Motor %&apos;direction&apos; %&apos;mm&apos;" type="command" category="eBrain"><header></header><code></code><translations></translations><inputs><input type="%s" readonly="true">Left<options>Left&#xD;Right</options></input><input type="%s" readonly="true">Forward<options>Forward&#xD;Back</options></input><input type="%n">100</input></inputs><script><block s="doIfElse"><block s="reportNot"><block s="reportListContainsItem"><block s="reportNewList"><list><l>Left</l><l>Right</l></list></block><block var="motor"/></block></block><script><block s="doRun"><block s="reportJSFunction"><list></list><l>alert(&apos;Must use with "Left" or "Right" motor &apos;);</l></block><list></list></block></script><script><block s="doIfElse"><block s="reportNot"><block s="reportListContainsItem"><block s="reportNewList"><list><l>Forward</l><l>Back</l></list></block><block var="direction"/></block></block><script><block s="doRun"><block s="reportJSFunction"><list></list><l>alert(&apos;Must use going "Forward" or "Backward"&apos;);</l></block><list></list></block></script><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>motor</l><l>direction</l><l>mm</l></list><l>world.moveon = 0;&#xD;var callback = function(state, msg) {&#xD;    if (state === &apos;complete&apos;) {&#xD;        world.moveon = 1;&#xD;    }&#xD;};&#xD;var actionStr = motor.toLowerCase() + &apos;Motor&apos; + (direction === &apos;Forward&apos; ? &apos;F&apos; : &apos;B&apos;);&#xD;//alert(actionStr);&#xD;eb.move(actionStr, mm, callback);</l></block><list><block var="motor"/><block var="direction"/><block var="mm"/></list></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>alert(&apos;Not implemented yet&apos;);_</l></block><list></list></block></script></block></script></block></script></block></script></block-definition><block-definition s="Both Motors %&apos;direction&apos; %&apos;mm&apos;" type="command" category="eBrain"><header></header><code></code><translations></translations><inputs><input type="%s" readonly="true">Forward<options>Forward&#xD;Back&#xD;Forward-Back&#xD;Back-Forward</options></input><input type="%n">100</input></inputs></block-definition><block-definition s="Close Connection" type="command" category="other"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>eb.ws.close();</l></block><list></list></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>world.port.close()</l></block><list></list></block></script></block></script></block-definition><block-definition s="%&apos;onOff&apos; Post to Server %&apos;server_host&apos; every %&apos;sec&apos;" type="command" category="eBrain"><header></header><code></code><translations></translations><inputs><input type="%s" readonly="true">On<options>On&#xD;Off</options></input><input type="%s">https://json.robotinacan.com/posts</input><input type="%n">10</input></inputs><script><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>WEB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>onOff</l><l>server_host</l><l>sec</l></list><l>function isOn(){if(onOff=="On"){return 1;}return 0;}&#xD;var msg = {cmd:"postToServer", arg:{"onOff":isOn(),"server":server_host,"time":sec}, "id":Math.random().toString(36).substr(2, 10)};&#xD;msg = filterUnicode(msg);&#xD;eb.send_msg(msg);</l></block><list><block var="onOff"/><block var="server_host"/><block var="sec"/></list></block></script></block><block s="doIf"><block s="reportEquals"><custom-block s="connection type"></custom-block><l>USB</l></block><script><block s="doRun"><block s="reportJSFunction"><list><l>onOff</l><l>server_host</l><l>sec</l></list><l>try{&#xD;function isOn(){if(onOff=="On"){return 1;}return 0;}&#xD;writeToStream(&apos;{cmd: "postToServer", arg: {\&apos;onOff\&apos;:&apos;+isOn()+&apos;, \&apos;server\&apos;:\&apos;&apos;+server_host+&apos;\&apos;, \&apos;time\&apos;:\&apos;&apos;+sec+&apos;\&apos;}, id:"3d8d9d4f6k"}&apos;);&#xD;}&#xD;catch(e){&#xD;console.log(e);&#xD;}</l></block><list><block var="onOff"/><block var="server_host"/><block var="sec"/></list></block></script></block></script></block-definition></blocks>
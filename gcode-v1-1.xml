<blocks app="Snap! 7, https://snap.berkeley.edu" version="2"><palette><category name="Advanced eBrain" color="0,116,143,1"/></palette><block-definition s="G-code to plotter %&apos;g-code&apos;" type="command" category="Advanced eBrain"><header></header><code></code><translations></translations><inputs><input type="%s"></input></inputs><script><block s="doDeclareVariables"><list><l>master list</l><l>x coords</l><l>y coords</l><l>previousX</l><l>previousY</l></list></block><block s="doSetVar"><l>master list</l><block s="evaluate"><block s="reportJSFunction"><list><l>gcode</l></list><l>function isValid(val) {&#xD;  return val !== undefined &amp;&amp; val !== null &amp;&amp; !isNaN(val);&#xD;}&#xD;&#xD;var points = [];&#xD;var lines = gcode.split(/\r?\n/);&#xD;for (const l of lines) {&#xD;  if (l.startsWith("G01")) {&#xD;    var line = l.split(" ");&#xD;    var point = {};&#xD;    for (const c of line) {&#xD;      if (c.startsWith("X")) {&#xD;        point.X = parseInt(c.substring(1));&#xD;      } else if (c.startsWith("Y")) {&#xD;        point.Y = parseInt(c.substring(1));&#xD;      }&#xD;    }&#xD;    if (isValid(point.X) &amp;&amp; isValid(point.Y)) {&#xD;      points.push(point);&#xD;    } else {&#xD;      morphicAlert("Error!", "Invalid point " + l + " is in the gcode");&#xD;      return new List([]);&#xD;    }&#xD;  }&#xD;}&#xD;if (points.length === 0) {&#xD;  morphicAlert("Error!", "No points were found in the Gcode");&#xD;  return new List([]);&#xD;}&#xD;var Xcoords = [], Ycoords = [];&#xD;for (const point of points) {&#xD;  Xcoords.push(point.X);&#xD;  Ycoords.push(point.Y);&#xD;}&#xD;return new List([new List(Xcoords), new List(Ycoords)]);</l></block><list><block var="g-code"/></list></block></block><block s="doIf"><block s="reportEquals"><l>0</l><block s="reportListAttribute"><l><option>length</option></l><block var="master list"/></block></block><script><block s="doStopThis"><l><option>this block</option></l></block></script></block><block s="doSetVar"><l>x coords</l><block s="reportListItem"><l>1</l><block var="master list"/></block></block><block s="doSetVar"><l>y coords</l><block s="reportListItem"><l>2</l><block var="master list"/></block></block><block s="doSetVar"><l>previousX</l><l>0</l></block><block s="doSetVar"><l>previousY</l><l>0</l></block><block s="doFor"><l>i</l><l>1</l><block s="reportListAttribute"><l><option>length</option></l><block var="x coords"/></block><script><block s="doDeclareVariables"><list><l>deltax</l><l>deltay</l></list></block><block s="doSetVar"><l>deltax</l><block s="reportDifference"><block s="reportListItem"><block var="i"/><block var="x coords"/></block><block var="previousX"/></block></block><block s="doSetVar"><l>deltay</l><block s="reportDifference"><block s="reportListItem"><block var="i"/><block var="y coords"/></block><block var="previousY"/></block></block><block s="doIfElse"><block s="reportGreaterThan"><block s="reportMonadic"><l><option>abs</option></l><block var="deltax"/></block><block s="reportMonadic"><l><option>abs</option></l><block var="deltay"/></block></block><script><custom-block s="Advanced Move Left distance: %s speed: %s Right distance: %s speed: %s"><block var="deltax"/><l>1</l><block var="deltay"/><block s="reportIfElse"><block s="reportEquals"><block var="deltay"/><l>0</l></block><l>1</l><block s="reportQuotient"><block s="reportMonadic"><l><option>abs</option></l><block var="deltay"/></block><block s="reportMonadic"><l><option>abs</option></l><block var="deltax"/></block></block></block></custom-block></script><script><custom-block s="Advanced Move Left distance: %s speed: %s Right distance: %s speed: %s"><block var="deltax"/><block s="reportIfElse"><block s="reportEquals"><block var="deltax"/><l>0</l></block><l>1</l><block s="reportQuotient"><block s="reportMonadic"><l><option>abs</option></l><block var="deltax"/></block><block s="reportMonadic"><l><option>abs</option></l><block var="deltay"/></block></block></block><block var="deltay"/><l>1</l></custom-block></script></block><block s="doSetVar"><l>previousX</l><block s="reportListItem"><block var="i"/><block var="x coords"/></block></block><block s="doSetVar"><l>previousY</l><block s="reportListItem"><block var="i"/><block var="y coords"/></block></block></script></block></script></block-definition></blocks>
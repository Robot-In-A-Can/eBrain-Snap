<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Snap!</title>
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="assets/css/main.css">
    <script type="text/javascript" src="assets/js/FileSaver.min.js"></script>
    <script type="text/javascript" src="assets/js/evebrain.js"></script>
    <script type="text/javascript" src="assets/js/evebrain-save.js"></script>
    <script type="text/javascript" src="assets/js/evebrain-app.js"></script>
    <script type="text/javascript" src="assets/js/persist.js"></script>
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
</head>

<body>
    <div id="header">
        <span class="connState"></span>
        <div id="save"></div>
        <div onClick = "instructionClick();"><h1 class="title"><img src="assets/logo_sm.png" alt="Robot In A Can Snap!" /></h1></div>
        <div id="instructions"><iframe id="instructionsframe" src="instructions.html"></iframe></div>
    </div>
    <div id="app">
        <script type="text/javascript" src="assets/apps/snap/src/morphic.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/widgets.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/blocks.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/threads.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/objects.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/gui.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/paint.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/lists.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/byob.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/tables.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/xml.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/store.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/locale.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/cloud.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/sha512.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/evebrain-snap.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/mirobot-snap.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/FileSaver.min.js"></script>
        <script type="text/javascript" src="assets/apps/snap/src/symbols.js?version=2019-06-27"></script>
        <script type="text/javascript" src="assets/apps/snap/src/sketch.js?version=2019-06-27"></script>
        <script type="text/javascript" src="assets/apps/snap/src/video.js?version=2019-06-27"></script>
        <script type="text/javascript" src="assets/apps/snap/src/maps.js?version=2019-06-27"></script>
        <script type="text/javascript">
        var evebrain;
        var world;
        var openclose = 0;

        instructionClick = function(){
            openclose += 1;
            if (openclose % 2 == 0) {
                document.getElementById('header').style.height = '56px';
                document.getElementById('instructions').style.visibility = 'hidden';
                document.getElementById('instructions').style.height = '0';
                document.getElementById('instructionsframe').style.visibility = 'hidden';
                document.getElementById('instructionsframe').style.height = '0';
            } else {
                document.getElementById('header').style.height = '80%';
                document.getElementById('instructions').style.visibility = 'visible';
                document.getElementById('instructions').style.height = '100%';
                document.getElementById('instructionsframe').style.visibility = 'visible';
                document.getElementById('instructionsframe').style.height = '100%';
            }
            console.log(openclose);
            
        }

        window.location = '#m=' + '192.168.4.1';

        var app = new EveBrainApp(function(m) {
            evebrain = m;
            m.version(function(status, msg) {
                if (Number(msg.msg) < 20150201 && !localStorage['_warning_done_']) {
                    localStorage['_warning_done_'] = true;
                    alert("You'll need to update your Arduino firmware to use the addon blocks (bump and line following) in this app, but the other blocks should still work fine.");
                }
            });
        });


        window.onload = function() {
            IDE_Morph.prototype.reactToWorldResize = function(rect) {
                if (this.isAutoFill) {
                    rect.origin.y = document.getElementById('header').getBoundingClientRect().height;
                    this.setPosition(rect.origin);
                    this.setExtent(rect.extent());
                }
                if (this.filePicker) {
                    document.body.removeChild(this.filePicker);
                    this.filePicker = null;
                }
            };

            world = new WorldMorph(document.getElementById('world'));

            world.worldCanvas.focus();
            var IDE = new IDE_Morph()
            IDE.openIn(world);

            app.initPersistence({
                saveHandler: function(name) {
                    IDE.setProjectName(name);
                    return IDE.serializer.serialize(IDE.stage);
                },
                loadHandler: function(prog) {
                    return IDE.rawOpenProjectString(prog);
                },
                clearHandler: function() {
                    return IDE.newProject();
                }
            });

            loop();
        };

        function loop() {
            requestAnimationFrame(loop);
            world.doOneCycle();
        }
        </script>
        <canvas id="world" tabindex="1" style="position: absolute;" />
    </div>
    <script type="text/javascript">
    [].forEach.call(document.links, function(l) {
        l.href = l.href + document.location.hash;
    });
    </script>
</body>

</html>
